<!doctype html> 
<head> 
  <title>Browsing GSSP information on Map</title> 
  <meta charset="utf-8">  
  
  <!-- sytle for lightbox - for popup images -->  
  <link href="style/lightbox.css" rel="stylesheet" />
  
  <style type='text/css'> 
    body {
      font-family:helvetica, arial, sans-serif;
    }
    
    table {
      border-collapse:collapse;  
      margin-top:20px;
    }
    table,th,td{
      border: 1px solid #CCC;
    } 
    td {
      padding:3px;
    }
  </style> 
  <link href="./style/wheel.css" rel="stylesheet"> 
<script type="text/javascript" src="http://gc.kis.v2.scr.kaspersky-labs.com/D993DA47-B7E1-0A43-8485-F62A343F1C47/main.js" charset="UTF-8"></script></head> 
 
<body> 

  <b>Global Boundary Stratotype Section and Point (<a href="http://en.wikipedia.org/wiki/GSSP" ">GSSP</a>) information retrieved from the <a href="http://resource.geosciml.org/vocabulary/timescale/isc2012.ttl" >ISC2012</a> ontology; <a href="./images/Tutorial_GSSP_portal.pdf">Tutorial of the demo portal</a> </b> 

  <div id="layerSelect" style="position: absolute; top:40px; width:1020px; height:30px;">
  <select name="LayerSelectOption" onchange="OverlayWMSLayer(this.value);"> 
    <option value="NoOverlay" selected="selected">No Overlay</option>
    <option value="BGS625kRA">UK (EPSG:3857)  | BGS 1:625K Bedrock Age</option>
	<option value="CCOP2MASIA">E- and SE-ASIA (EPSG:900913)  | GSJ CCOP 1:2M Combined Bedrock and Superficial Geology and Age</option>
	<option value="CHE500kGU">Switzerland (EPSG:900913)  | CHE SGS 1:500K Geological Units</option>
	<option value="USGS500kCOGL">Colorado State, USA (EPSG:3857)  | Colorado USGS 1:500K Geology - Lithology</option>
	<option value="USGS500kNVGL">Nevada State, USA (EPSG:3857)  | Nevada USGS 1:500K Geology - Lithology</option>
	<option value="USGS250kNYGL">New York State, USA (EPSG:3857)  | New York USGS 1:250K Geology - Lithology</option>
	<option value="USGS250kOKGL">Oklahoma State, USA (EPSG:3857)  | Oklahoma USGS 1:250K Geology - Lithology</option>
	<option value="USGS500kTXGL">Texas State, USA (EPSG:3857)  | Texas USGS 1:500K Geology - Lithology</option>
	<option value="USGS250kUTGL">Utah State, USA (EPSG:3857)  | Utah USGS 1:500K Geology - Lithology</option>
	<option value="BRGM1MSGU">France (EPSG:4326)  | 1GE BRGM 1:1M Surface Geologic Unit</option>
	<option value="BGR1MGU">Germany (EPSG:4326)  | BGR EN 1:1M Geologic Unit</option>
	<option value="ISPRA500kGU">Italy (EPSG:4326)  | ITA ISPRA/SGI EN 1:500K Geologic Age</option>
	<option value="AUS2d5MGUA">Australia (EPSG:4326)  | AUS GA 1:2.5M Geologic Unit - Age</option>
	<option value="SIGA10MBA">Africa (EPSG:4326)  | Africa SIGAfrique 1:10M Bedrock Age</option>
<!--	<option value="CGS1MGeoMap">China (EPSG:4326)  | China Geological Survey 1:1M Geological Map (in CN)</option>  -->
	<option value="CGS5MGeoMap">China (EPSG:4326)  | China Geological Survey 1:5M Geological Map (in CN)</option>
    <option value="BRGM50MOnshore">World (EPSG:4326)  | BRGM CGMW 1:50M Geological Units Onshore</option>
  </select>
  </div>
  
  <div id="map_canvas" style="position: absolute; top:70px; width:1020px; height:780px;"></div> 
  <!--some further work is needed to assign relative position to div 'vis' for the geologic time pie-->
  <div id="vis" style="position: absolute; left: 1020px; top:50px; overflow: hidden; "></div>
  
  <table id="results" style="position: absolute; top:860px; width:1580px;"></table> 
 
 <!-- Google maps api--> 
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"> </script> 
  
  <!-- d3.js for visualization -->    
  <script language="javascript" src="./d3lib/d3.v2.js"></script>
  <!-- the geologic time pie -->  
  <script language="javascript" src="iscwheel.js"></script>
   
  <!-- jquery --> 
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script> 
  
  <!-- jquery min for using in the light box js -->
  <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
  <!-- lightbox - for popup images --> 
  <script type="text/javascript" src="js/lightbox.js"></script>
  <!-- wms - for overlaying WMS layers and get feature info --> 
  <script type="text/javascript" src="js/wms.js"></script>

  <script type="text/javascript"> 
	/* sparql code for queryUrl   additional: (1) sparql endpoint: http://geotime.tw.rpi.edu/fuseki/ds/query? (2) add &output=json in the queryUrl
///////////note the changes in the URI of prefixes compared to ISC2010///////////////
///////////note (1) basic:value --> basic:amount////////////////////
////////////////(2) gtrs:position --> tm:position//////////
////////////////(3) gts:Age  -->   <http://resource.geosciml.org/ontology/timescale/rank/Age>            
PREFIX gts: <http://resource.geosciml.org/ontology/timescale/gts-30#> 
PREFIX gtrs: <http://resource.geosciml.org/ontology/timescale/gtrs-30#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
PREFIX sam: <http://def.seegrid.csiro.au/isotc211/iso19156/2011/sampling#>
PREFIX gm: <http://def.seegrid.csiro.au/isotc211/iso19107/2003/geometry#> 
PREFIX tm: <http://def.seegrid.csiro.au/isotc211/iso19108/2006/temporal#>
PREFIX basic: <http://def.seegrid.csiro.au/isotc211/iso19103/2005/basic#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
 
SELECT ?gsspLabel ?primaryGuidingCriterion ?coordinates ?age ?ageUncertainty ?detailedConceptName
WHERE 
{
?base gts:stratotype ?gssp;
      tm:position ?baseTime.
?gssp rdfs:label ?gsspLabel;
      gts:primaryGuidingCriterion ?primaryGuidingCriterion;
      sam:shape ?gsspLocation.
?gsspLocation gm:position ?gsspPosition.
?gsspPosition gm:coordinates ?coordinates.
?baseTime tm:value ?age.
OPTIONAL
{
?base gtrs:positionalUncertainty ?baseTimeUncertainty.
?baseTimeUncertainty basic:amount ?ageUncertainty.
}
{
?lowestRankConcept gts:rank <http://resource.geosciml.org/ontology/timescale/rank/Age>;
                       gtrs:start ?base.
}
UNION
{
?lowestRankConcept rdfs:label "Ediacaran Period"@en;
                       gtrs:start ?base.
}
UNION
{
?lowestRankConcept rdfs:label "Holocene Epoch"@en;
                       gtrs:start ?base.
}
UNION
{
?lowestRankConcept rdfs:label "Pridoli Epoch"@en;
                       gtrs:start ?base.
}
?lowestRankConcept skos:prefLabel ?detailedConceptName
FILTER (lang(?detailedConceptName) = "en" )
}
ORDER BY ?age
	*/
 
	//the query gets label, criterion, coordinates, age and ageuncertainty of each gssp (see sparql codes above)
	//var queryUrl = "http://sparql.tw.rpi.edu/virtuoso/sparql?default-graph-uri=&should-sponge=&query=PREFIX+gts%3A+%3Chttp%3A%2F%2Fresource.geosciml.org%2Fschema%2Fcgi%2Fgts%2F3.0%2F%3E+%0D%0APREFIX+gtrs%3A+%3Chttp%3A%2F%2Fresource.geosciml.org%2Fschema%2Fcgi%2Ftrs%2F3.0%2F%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E+%0D%0APREFIX+sam%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19156%2F2011%2Fsampling%2F%3E%0D%0APREFIX+gm%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19107%2F2003%2Fgeometry%2F%3E+%0D%0APREFIX+tm%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19108%2F2006%2Ftemporalobject%2F%3E%0D%0APREFIX+basic%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19103%2F2005%2Fbasictype%2F%3E%0D%0A+%0D%0ASELECT+%3FgsspLabel+%3FprimaryGuidingCriterion+%3Fcoordinates+%3Fage+%3FageUncertainty%0D%0AWHERE+%0D%0A{%0D%0Agraph+%3Chttp%3A%2F%2Fsparql.tw.rpi.edu%2F20120831%2Fisc2010test%3E%0D%0A{%0D%0A%3Fbase+gts%3Astratotype+%3Fgssp%3B%0D%0A++++++gtrs%3Aposition+%3FbaseTime.%0D%0A%3Fgssp+rdfs%3Alabel+%3FgsspLabel%3B%0D%0A++++++gts%3AprimaryGuidingCriterion+%3FprimaryGuidingCriterion%3B%0D%0A++++++sam%3Ashape+%3FgsspLocation.%0D%0A%3FgsspLocation+gm%3Aposition+%3FgsspPosition.%0D%0A%3FgsspPosition+gm%3Acoordinates+%3Fcoordinates.%0D%0A%3FbaseTime+tm%3Avalue+%3Fage.%0D%0AOPTIONAL%0D%0A{%0D%0A%3Fbase+gtrs%3ApositionalUncertainty+%3FbaseTimeUncertainty.%0D%0A%3FbaseTimeUncertainty+basic%3Avalue+%3FageUncertainty.%0D%0A}%0D%0A}%0D%0A}%0D%0AORDER+BY+%3Fage&output=json&debug=on&timeout=";
    //var queryUrl = "http://sparql.tw.rpi.edu/virtuoso/sparql?query=PREFIX+gts%3A+%3Chttp%3A%2F%2Fresource.geosciml.org%2Fschema%2Fcgi%2Fgts%2F3.0%2F%3E+%0D%0APREFIX+gtrs%3A+%3Chttp%3A%2F%2Fresource.geosciml.org%2Fschema%2Fcgi%2Ftrs%2F3.0%2F%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E+%0D%0APREFIX+sam%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19156%2F2011%2Fsampling%2F%3E%0D%0APREFIX+gm%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19107%2F2003%2Fgeometry%2F%3E+%0D%0APREFIX+tm%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19108%2F2006%2Ftemporalobject%2F%3E%0D%0APREFIX+basic%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19103%2F2005%2Fbasictype%2F%3E%0D%0APREFIX+skos%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0A+%0D%0ASELECT+%3FgsspLabel+%3FprimaryGuidingCriterion+%3Fcoordinates+%3Fage+%3FageUncertainty+%3FdetailedConceptName%0D%0AWHERE+%0D%0A{%0D%0Agraph+%3Chttp%3A%2F%2Fsparql.tw.rpi.edu%2F20121019%2Fisc2012test%3E%0D%0A{%0D%0A%3Fbase+gts%3Astratotype+%3Fgssp%3B%0D%0A++++++gtrs%3Aposition+%3FbaseTime.%0D%0A%3Fgssp+rdfs%3Alabel+%3FgsspLabel%3B%0D%0A++++++gts%3AprimaryGuidingCriterion+%3FprimaryGuidingCriterion%3B%0D%0A++++++sam%3Ashape+%3FgsspLocation.%0D%0A%3FgsspLocation+gm%3Aposition+%3FgsspPosition.%0D%0A%3FgsspPosition+gm%3Acoordinates+%3Fcoordinates.%0D%0A%3FbaseTime+tm%3Avalue+%3Fage.%0D%0AOPTIONAL%0D%0A{%0D%0A%3Fbase+gtrs%3ApositionalUncertainty+%3FbaseTimeUncertainty.%0D%0A%3FbaseTimeUncertainty+basic%3Avalue+%3FageUncertainty.%0D%0A}%0D%0A{%0D%0A%3FlowestRankConcept+gts%3Arank+gts%3AAge%3B%0D%0A+++++++++++++++++++++++gtrs%3Astart+%3Fbase.%0D%0A}%0D%0AUNION%0D%0A{%0D%0A%3FlowestRankConcept+rdfs%3Alabel+%22Ediacaran+Period%22%40en%3B%0D%0A+++++++++++++++++++++++gtrs%3Astart+%3Fbase.%0D%0A}%0D%0AUNION%0D%0A{%0D%0A%3FlowestRankConcept+rdfs%3Alabel+%22Holocene+Epoch%22%40en%3B%0D%0A+++++++++++++++++++++++gtrs%3Astart+%3Fbase.%0D%0A}%0D%0AUNION%0D%0A{%0D%0A%3FlowestRankConcept+rdfs%3Alabel+%22Pridoli+Epoch%22%40en%3B%0D%0A+++++++++++++++++++++++gtrs%3Astart+%3Fbase.%0D%0A}%0D%0A%3FlowestRankConcept+skos%3AprefLabel+%3FdetailedConceptName%0D%0AFILTER+%28lang%28%3FdetailedConceptName%29+%3D+%22en%22+%29%0D%0A}%0D%0A}%0D%0AORDER+BY+%3Fage&output=json";  
	var queryUrl = "http://geotime.tw.rpi.edu/fuseki/ds/query?query=PREFIX+gts%3A+%3Chttp%3A%2F%2Fresource.geosciml.org%2Fontology%2Ftimescale%2Fgts-30%23%3E+%0D%0APREFIX+gtrs%3A+%3Chttp%3A%2F%2Fresource.geosciml.org%2Fontology%2Ftimescale%2Fgtrs-30%23%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E+%0D%0APREFIX+sam%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19156%2F2011%2Fsampling%23%3E%0D%0APREFIX+gm%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19107%2F2003%2Fgeometry%23%3E+%0D%0APREFIX+tm%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19108%2F2006%2Ftemporal%23%3E%0D%0APREFIX+basic%3A+%3Chttp%3A%2F%2Fdef.seegrid.csiro.au%2Fisotc211%2Fiso19103%2F2005%2Fbasic%23%3E%0D%0APREFIX+skos%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0A+%0D%0ASELECT+%3FgsspLabel+%3FprimaryGuidingCriterion+%3Fcoordinates+%3Fage+%3FageUncertainty+%3FdetailedConceptName%0D%0AWHERE+%0D%0A{%0D%0A%3Fbase+gts%3Astratotype+%3Fgssp%3B%0D%0A++++++tm%3Aposition+%3FbaseTime.%0D%0A%3Fgssp+rdfs%3Alabel+%3FgsspLabel%3B%0D%0A++++++gts%3AprimaryGuidingCriterion+%3FprimaryGuidingCriterion%3B%0D%0A++++++sam%3Ashape+%3FgsspLocation.%0D%0A%3FgsspLocation+gm%3Aposition+%3FgsspPosition.%0D%0A%3FgsspPosition+gm%3Acoordinates+%3Fcoordinates.%0D%0A%3FbaseTime+tm%3Avalue+%3Fage.%0D%0AOPTIONAL%0D%0A{%0D%0A%3Fbase+gtrs%3ApositionalUncertainty+%3FbaseTimeUncertainty.%0D%0A%3FbaseTimeUncertainty+basic%3Aamount+%3FageUncertainty.%0D%0A}%0D%0A{%0D%0A%3FlowestRankConcept+gts%3Arank+%3Chttp%3A%2F%2Fresource.geosciml.org%2Fontology%2Ftimescale%2Frank%2FAge%3E%3B%0D%0A+++++++++++++++++++++++gtrs%3Astart+%3Fbase.%0D%0A}%0D%0AUNION%0D%0A{%0D%0A%3FlowestRankConcept+rdfs%3Alabel+%22Ediacaran+Period%22%40en%3B%0D%0A+++++++++++++++++++++++gtrs%3Astart+%3Fbase.%0D%0A}%0D%0AUNION%0D%0A{%0D%0A%3FlowestRankConcept+rdfs%3Alabel+%22Holocene+Epoch%22%40en%3B%0D%0A+++++++++++++++++++++++gtrs%3Astart+%3Fbase.%0D%0A}%0D%0AUNION%0D%0A{%0D%0A%3FlowestRankConcept+rdfs%3Alabel+%22Pridoli+Epoch%22%40en%3B%0D%0A+++++++++++++++++++++++gtrs%3Astart+%3Fbase.%0D%0A}%0D%0A%3FlowestRankConcept+skos%3AprefLabel+%3FdetailedConceptName%0D%0AFILTER+%28lang%28%3FdetailedConceptName%29+%3D+%22en%22+%29%0D%0A}%0D%0AORDER+BY+%3Fage&output=json";
	
    $.ajax({ 
      dataType: "jsonp",
      url: queryUrl,
      success: function(data) {     
        
        // get the table element in this the web page
        var table = $("#results");              
        
        // get the sparql variables from the 'head' of the data.
        var headerVars = data.head.vars; 
   
        // using the vars, make some table headers and add them to the table;
        var trHeaders = getTableHeaders(headerVars);
        table.append(trHeaders);  
        
        // grab the actual results from the data.                                          
        var bindings = data.results.bindings;
                                                 
        // for each result, make a table row and add it to the table.
        for(rowIdx in bindings){
          table.append(getTableRow(headerVars, bindings[rowIdx]));
        }
        
        drawMap(data);
      }
    });                              
     
     
    function getTableHeaders(headerVars) {                                
       var trHeaders = $("<tr></tr>");     
       for(var i in headerVars) {    
         trHeaders.append( $("<th>" + headerVars[i] + "</th>") ); 
       }
       return trHeaders;
     }                              
     
     function getTableRow(headerVars, rowData) {
       var tr = $("<tr></tr>");                                 
       
       for(var i in headerVars) {             
         tr.append(getTableCell(headerVars[i], rowData));
       } 
       
       return tr;     
     }  
     
     function getTableCell(fieldName, rowData){
       var td = $("<td></td>");
	  
       var fieldData = rowData[fieldName];
	    if (fieldData == null) { 	// some vaules of field 'ageUncertainty' are null
		  td.html("Null"); 
		  if ( fieldName == 'ageUncertainty' )
		    td.html("0 Ma"); 
		}			//
	   else	{					//
          td.html( fieldData["value"] );
		  if ( fieldName == 'age' ) // round the number in 'age' to four decimal digits and turn into string - the float data retrieved from virtuoso triple store have very long decimal digits
		    td.html( roundNumber(fieldData["value"],4).toString() + ' Ma' );
		  if ( fieldName == 'ageUncertainty' ) // round the number in 'ageUncertainty' to one decimal digit and turn into string - the float data retrieved from virtuoso triple store have very long decimal digits
		    td.html( roundNumber(fieldData["value"],1).toString() + ' Ma' );  
		}
       return td;      
     } 
	 
	 var infoPopup = new google.maps.InfoWindow; // define infoPopup as a global variable to avoid this: popup a new window for each marker while the previously popup window is not closed 
	 var gsspMarkers = [];  // an array to store all the gssp markers inside the map
     var map = new google.maps.Map(document.getElementById("map_canvas")); //define map as a global variable because it is used in iscwheel.js 
	 function drawMap(data){      
       // make a map, centred on Manchester
       var worldCenter = new google.maps.LatLng(0, 0);     
       var myOptions = {
         zoom: 2,
         center: worldCenter,
		 scaleControl: true,
         mapTypeId: google.maps.MapTypeId.ROADMAP
       };
	   /*
	   {
			panControl: boolean,
			zoomControl: boolean,
			mapTypeControl: boolean,
			scaleControl: boolean,
			streetViewControl: boolean,
			overviewMapControl: boolean
		}
	   */
        map.setOptions(myOptions);
       // add a marker for each gssp 
       var bindings = data.results.bindings; 
       for (var i in bindings) {
 
         var gsspData = data.results.bindings[i];
 
         var lat = getNorthValue(gsspData["coordinates"]["value"]); 
         var lng = getEastValue(gsspData["coordinates"]["value"]); 
         var label = gsspData["gsspLabel"]["value"];
		 var criterion = gsspData["primaryGuidingCriterion"]["value"];
		 var age = roundNumber(gsspData["age"]["value"], 4).toString(); //values of datatype float retrieved from Virtuoso triple store are with very long digits after decimal point. here we round them to format with 4 digits after decimal
		 var unctn; 
		  if(gsspData["ageUncertainty"] != null) // some vaules of field 'ageUncertainty' are null
		  unctn = roundNumber(gsspData["ageUncertainty"]["value"], 1).toString();
		  else
		  unctn = '0';
		 var cptName = gsspData["detailedConceptName"]["value"]; 
		 // seeAlso is a link to an image with detail info of the corresponding gssp
		 // in isc2010 ontology the name of gssp is associated with the highest concept, e.g., gssp of base Mesozoic 
		 // on website of Geologic TimeScale Foundation, name of gssp is with lowest concept, e.g. gssp of base Induan (the same gssp as the gssp of base Mesozoic)
		 // a full list of images about gssp: https://engineering.purdue.edu/Stratigraphy/images/combined/full/
		 var seeAlso = 'For details see also: ' + '<a id="gtsName" rel="lightbox" href="https://engineering.purdue.edu/Stratigraphy/images/combined/full/' + cptName +'_GSSP_web_June20121.jpg" >' + 'Base of ' + cptName + '</a>';
		  if (cptName == 'Katian') //a special setting for 'Katian' due to the special URL of it on that website
		  seeAlso = 'For details see also: ' + '<a id="gtsName" rel="lightbox" href="https://engineering.purdue.edu/Stratigraphy/images/combined/full/' + cptName +'_GSSP_web_July20121.jpg" >' + 'Base of ' + cptName + '</a>';
		  if (cptName == 'Rupelian') //a special setting for 'Rupelian' due to the special URL of it on that website
		  seeAlso = 'For details see also: ' + '<a id="gtsName" rel="lightbox" href="https://engineering.purdue.edu/Stratigraphy/images/combined/full/' + cptName +'_GSSP__web_June20121.jpg" >' + 'Base of ' + cptName + '</a>';
 		  if (cptName == 'Famennian') //a special setting for 'Famennian' due to the special URL of it on that website
		  seeAlso = 'For details see also: ' + '<a id="gtsName" rel="lightbox" href="https://engineering.purdue.edu/Stratigraphy/images/combined/full/' + 'Famenne' +'_GSSP_web_June20121.jpg" >' + 'Base of ' + cptName + '</a>';
		  if (cptName == 'Frasnian') //a special setting for 'Frasnian' due to the special URL of it on that website
		  seeAlso = 'For details see also: ' + '<a id="gtsName" rel="lightbox" href="https://engineering.purdue.edu/Stratigraphy/images/combined/full/' + 'Frasne' +'_GSSP_web_June20121.jpg" >' + 'Base of ' + cptName + '</a>';
		  if (cptName == 'Visean') //a special setting for 'Visean' due to the special URL of it on that website
		  seeAlso = 'For details see also: ' + '<a id="gtsName" rel="lightbox" href="https://engineering.purdue.edu/Stratigraphy/images/combined/full/' + 'Visean' +'_GSSP_web_Jun20121.jpg" >' + 'Base of ' + cptName + '</a>';
		  if (cptName == 'Rhuddanian') //a special setting for 'Rhuddanian' due to the special URL of it on that website
		  seeAlso = 'For details see also: ' + '<a id="gtsName" rel="lightbox" href="https://engineering.purdue.edu/Stratigraphy/images/combined/full/' + 'Rhudd' +'_GSSP_web_June20121.jpg" >' + 'Base of ' + cptName + '</a>';		 
		 
		  if (cptName == 'Ladinian') //a special setting for 'Ladinian' due to the special URL of it on that website
		  seeAlso = 'For details see also: ' + '<a id="gtsName" rel="lightbox" href="https://engineering.purdue.edu/Stratigraphy/images/combined/full/' + cptName +'_GSSP_web_JuJune20121.jpg" >' + 'Base of ' + cptName + '</a>';
		  if (cptName == 'Piacenzian') //a special setting for 'Piacenzian' due to the special URL of it on that website
		  seeAlso = 'For details see also: ' + '<a id="gtsName" rel="lightbox" href="https://engineering.purdue.edu/Stratigraphy/images/combined/full/' + 'Piazencian' +'_GSSP_web_June20121.jpg" >' + 'Base of ' + cptName + '</a>';
		 
		 var gsspInfo;
		  if (unctn == '0') //when age uncertainty is '0', there is no need to add an uncertainty value
		  gsspInfo = '<b>' + label + '</b><br/><br/>' + 'Primary Guiding Criterion: ' + criterion
						+ '<br/><br/> Age: ' + age + ' Ma (the unit Ma means "millions of years ago")'
						+ '<br/><br/>' + seeAlso;
		  else 
		  gsspInfo = '<b>' + label + '</b><br/><br/>' + 'Primary Guiding Criterion: ' + criterion
						+ '<br/><br/> Age: ' + age + ' +/- ' + unctn + ' Ma (the unit Ma means "millions of years ago")'
						+ '<br/><br/>' + seeAlso;
		 
		 // make a icon
		 // var gsspIcon = new google.maps.MarkerImage("gssp.png", new google.maps.Size(42, 21));
        
 		 // make a gssp marker 
         var marker = new google.maps.Marker({
           position: new google.maps.LatLng( lat, lng ), 
           icon: "gssp.png",
		   map: map, 
           title: label,
		   html: gsspInfo, // to be used as content in the popup infoWindow
		   lowestconcept: cptName // to be used as a label to be sent to the geologic time pie visualzation
         }); 
	     // use one infowindow 'infoPopup' for all the markers, just change the content inside when change between markers
		 google.maps.event.addListener(marker, 'click', function () {                
           infoPopup.setContent(this.html); //here should use 'this' but not 'marker', otherwise it always points to the last marker after the looping
           infoPopup.open(map, this);
		   hightlightLabel(this.lowestconcept); // in the geologic time pie, highlight a node related to the clicked gssp
		   infoPopupWMS.close(); // close pop up window of WMS feature info
		 });
		 
		 google.maps.event.addListener(marker.getMap(), 'click', function() {
          infoPopup.close(); //click the map area to close the popup window 
         });
		 
		 gsspMarkers.push(marker);
       }  
	   
     }
	 
     // ISC2010 coordinates use EPSG4326. EPSG 4326 defines a full coordinate reference system
	 // 4326 is the EPSG identifier of WGS84
	 // EPSG 4326 can be understood as latitude and longitude coordinates on the WGS84 reference ellipsoid
	 
     // returns north in the isc2010 coordinates
	 function getNorthValue(coord) {
	 	var coordsArray = new Array();
		coordsArray = coord.split(" ");
		return coordsArray[0];
	 }
	 	 
	 // returns east in the isc2010 coordinates
	 function getEastValue(coord) {
	 	var coordsArray = new Array();
		coordsArray = coord.split(" ");
		return coordsArray[1];
	 }
	 
	 // round a number, n: number; dec: digits after decimal, if in minus value, digits before decimal
	 function roundNumber(n,dec) {
		n = parseFloat(n);
		if(!isNaN(n)){
			if(!dec) var dec= 0;
			var factor= Math.pow(10,dec);
			return Math.floor(n*factor+((n*factor*10)%10>=5?1:0))/factor;
		}else{
			return n;
		}
	 }  
	 
      

	var WmsServerURL;
	var WmsLayerName;
	var listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {});
	var listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function() {});	
	var EpsgCode; // EPSG code for projection reference
	var VersionCode; // version code of WMS service
	
	// a source of geologic map WMS: http://portal.onegeology.org/catalogView.jsp
	// overlay the  WMS layer chosen from the dropbox into the map window
	function OverlayWMSLayer(layerChosen) {
	  infoPopup.close();
	  infoPopupWMS.close();
	  map.overlayMapTypes.clear();  //clear any currently overlayed WMS layers in the google maps window
      google.maps.event.removeListener(listenerHandleWmsInfoClose); // remove the wms info listener
	  google.maps.event.removeListener(listenerHandleWmsInfoOpen); // remove the wms info listener
	 
 	  if (layerChosen == "NoOverlay") {
		map.setOptions({draggableCursor: null});
		map.setOptions({draggingCursor: null});
		map.panTo(new google.maps.LatLng(0, 0)); // World in the center
		map.setZoom(2); 
		return;
	  }
	  
	  if (layerChosen == "BGS625kRA") {
	    WmsServerURL = 'http://ogc.bgs.ac.uk/cgi-bin/BGS_Bedrock_and_Superficial_Geology/wms?';
		WmsLayerName = 'GBR_BGS_625k_BA';
		EpsgCode = "SRS=EPSG:3857"; //EpsgCode is to be used in ClickForWmsInfoEpsg3857OrEpsg900913()
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://ogc.bgs.ac.uk/cgi-bin/BGS_Bedrock_and_Superficial_Geology/wms?service=WMS&version=1.1.1&request=GetCapabilities
	
        var customParams = [
		    "SRS=EPSG:3857", // note epsg:900913 is the old version of to EPSG:3857
			"VERSION=1.1.1",
            "LAYERS=GBR_BGS_625k_BA"
        ];
		
		//loadWMSEpsg3857OrEpsg900913() is defined in wms.js
		loadWMSEpsg3857OrEpsg900913(map, WmsServerURL, customParams);
			
		map.panTo(new google.maps.LatLng(55, -4)); // UK in the center
		map.setZoom(6); 
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg3857OrEpsg900913(event.latLng);
		});	 
		
		map.setOptions({draggableCursor: 'help'});
		map.setOptions({draggingCursor: 'help'});
	  }

	  if (layerChosen == "CCOP2MASIA") {
	    WmsServerURL = 'http://ows.geogrid.org/GSJ_CCOP_Combined_Bedrock_and_Superficial_Geology_and_Age/wms?';
		WmsLayerName = 'EASIA_CCOP_2M_Combined_BLT_SLT_BA';
		EpsgCode = "SRS=EPSG:900913";  //EpsgCode is to be used in ClickForWmsInfoEpsg3857OrEpsg900913()
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://ows.geogrid.org/GSJ_CCOP_Combined_Bedrock_and_Superficial_Geology_and_Age/wms?service=WMS&version=1.1.1&request=GetCapabilities
	
        var customParams = [
		    "SRS=EPSG:900913", // note epsg:900913 is the old version of to EPSG:3857
            "VERSION=1.1.1",
			"LAYERS=EASIA_CCOP_2M_Combined_BLT_SLT_BA"
        ];
		
		//loadWMSEpsg3857OrEpsg900913() is defined in wms.js
		loadWMSEpsg3857OrEpsg900913(map, WmsServerURL, customParams);
			
		map.panTo(new google.maps.LatLng(21, 120)); // SE Asia in the center
		map.setZoom(4); 
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg3857OrEpsg900913(event.latLng);
		});	 
		
		map.setOptions({draggableCursor: 'help'});
		map.setOptions({draggingCursor: 'help'});
	  }	
	  
	  
	  if (layerChosen == "CHE500kGU") {
	    WmsServerURL = 'http://wms.ga.admin.ch/SGS_Geol_Tecto/wms?';
		WmsLayerName = 'CHE_SGS_500k_GeologicalUnits';
		EpsgCode = "SRS=EPSG:900913";  //EpsgCode is to be used in ClickForWmsInfoEpsg3857OrEpsg900913()
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://wms.ga.admin.ch/SGS_Geol_Tecto/wms?&service=WMS&version=1.1.1&request=GetCapabilities
	    // NOTE that this wms server (Switzerland) temporarilly does not work on GetFeatureInfo (2012-11-06)
        var customParams = [
		    "SRS=EPSG:900913", // note epsg:900913 is the old version of to EPSG:3857
            "VERSION=1.1.1",
			"LAYERS=CHE_SGS_500k_GeologicalUnits"
        ];
		
		//loadWMSEpsg3857OrEpsg900913() is defined in wms.js
		loadWMSEpsg3857OrEpsg900913(map, WmsServerURL, customParams);
			
		map.panTo(new google.maps.LatLng(46.8, 8.5)); // Switzerland in the center
		map.setZoom(7); 
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg3857OrEpsg900913(event.latLng);
		});	 
		
		map.setOptions({draggableCursor: 'help'});
		map.setOptions({draggingCursor: 'help'});
	  }	


	  
      //Colorado geology - lithology
	  if (layerChosen == "USGS500kCOGL"){    //*********************
		WmsServerURL = 'http://mrdata.usgs.gov/services/co?'; //*********************
		WmsLayerName = 'Colorado_Lithology';  //*********************
		EpsgCode = "SRS=EPSG:3857";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://mrdata.usgs.gov/services/co?service=WMS&version=1.1.1&request=GetCapabilities
	     
        var customParams = [
		    "SRS=EPSG:3857", 
            "VERSION=1.1.1",
			"LAYERS=Colorado_Lithology"  //*********************
        ];
		
		//loadWMSEpsg3857OrEpsg900913() is defined in wms.js
		loadWMSEpsg3857OrEpsg900913(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(39, -106)); // CO state in the center   //*********************
		map.setZoom(7);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg3857OrEpsg900913(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }		  

	  
      //Nevada geology - lithology
	  if (layerChosen == "USGS500kNVGL"){    //*********************
		WmsServerURL = 'http://mrdata.usgs.gov/services/nv?'; //*********************
		WmsLayerName = 'Nevada_Lithology';  //*********************
		EpsgCode = "SRS=EPSG:3857";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://mrdata.usgs.gov/services/nv?service=WMS&version=1.1.1&request=GetCapabilities
	     
        var customParams = [
		    "SRS=EPSG:3857", 
            "VERSION=1.1.1",
			"LAYERS=Nevada_Lithology"  //*********************
        ];
		
		//loadWMSEpsg3857OrEpsg900913() is defined in wms.js
		loadWMSEpsg3857OrEpsg900913(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(38.5, -116.8)); // CO state in the center   //*********************
		map.setZoom(7);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg3857OrEpsg900913(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }		  	  
	  
	  
      //New York geology - lithology
	  if (layerChosen == "USGS250kNYGL"){    //*********************
		WmsServerURL = 'http://mrdata.usgs.gov/services/ny?'; //*********************
		WmsLayerName = 'New_York_Lithology';  //*********************
		EpsgCode = "SRS=EPSG:3857";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://mrdata.usgs.gov/services/ny?service=WMS&version=1.1.1&request=GetCapabilities
	     
        var customParams = [
		    "SRS=EPSG:3857", 
            "VERSION=1.1.1",
			"LAYERS=New_York_Lithology"  //*********************
        ];
		
		//loadWMSEpsg3857OrEpsg900913() is defined in wms.js
		loadWMSEpsg3857OrEpsg900913(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(42.5, -76)); // NY state in the center   //*********************
		map.setZoom(7);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg3857OrEpsg900913(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }	
  

      //Oklahoma geology - lithology
	  if (layerChosen == "USGS250kOKGL"){    //*********************
		WmsServerURL = 'http://mrdata.usgs.gov/services/ok?'; //*********************
		WmsLayerName = 'Oklahoma_Lithology';  //*********************
		EpsgCode = "SRS=EPSG:3857";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://mrdata.usgs.gov/services/ok?service=WMS&version=1.1.1&request=GetCapabilities
	     
        var customParams = [
		    "SRS=EPSG:3857", 
            "VERSION=1.1.1",
			"LAYERS=Oklahoma_Lithology"  //*********************
        ];
		
		//loadWMSEpsg3857OrEpsg900913() is defined in wms.js
		loadWMSEpsg3857OrEpsg900913(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(35.3, -98.5)); // NY state in the center   //*********************
		map.setZoom(7);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg3857OrEpsg900913(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }	  


      //Texas geology - lithology
	  if (layerChosen == "USGS500kTXGL"){    //*********************
		WmsServerURL = 'http://mrdata.usgs.gov/services/tx?'; //*********************
		WmsLayerName = 'Texas_Lithology';  //*********************
		EpsgCode = "SRS=EPSG:3857";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://mrdata.usgs.gov/services/tx?service=WMS&version=1.1.1&request=GetCapabilities
	     
        var customParams = [
		    "SRS=EPSG:3857", 
            "VERSION=1.1.1",
			"LAYERS=Texas_Lithology"  //*********************
        ];
		
		//loadWMSEpsg3857OrEpsg900913() is defined in wms.js
		loadWMSEpsg3857OrEpsg900913(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(31, -99.5)); // NY state in the center   //*********************
		map.setZoom(6);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg3857OrEpsg900913(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }		  


      //Utah geology - lithology
	  if (layerChosen == "USGS250kUTGL"){    //*********************
		WmsServerURL = 'http://mrdata.usgs.gov/services/ut?'; //*********************
		WmsLayerName = 'Utah_Lithology';  //*********************
		EpsgCode = "SRS=EPSG:3857";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://mrdata.usgs.gov/services/ut?service=WMS&version=1.1.1&request=GetCapabilities
	     
        var customParams = [
		    "SRS=EPSG:3857", 
            "VERSION=1.1.1",
			"LAYERS=Utah_Lithology"  //*********************
        ];
		
		//loadWMSEpsg3857OrEpsg900913() is defined in wms.js
		loadWMSEpsg3857OrEpsg900913(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(39.2, -111.5)); // NY state in the center   //*********************
		map.setZoom(7);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg3857OrEpsg900913(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }		  	  	  


	  
      // this layer uses projection reference EPSG:4326
      // so the loaded layer image cannot match precisely with google maps (EPSG:3857)
 	  if (layerChosen == "BRGM1MSGU"){    //*********************
		WmsServerURL = 'http://mapsone.brgm.fr/1GEconnector/?'; //*********************
		WmsLayerName = 'OGE_1M_surface_GeologicUnit';  //*********************
		EpsgCode = "SRS=EPSG:4326";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://mapsone.brgm.fr/1GEconnector/?service=WMS&version=1.1.1&request=GetCapabilities
	
        var customParams = [
		    "SRS=EPSG:4326", 
            "VERSION=1.1.1",
			"LAYERS=OGE_1M_surface_GeologicUnit"  //*********************
        ];
		
		//loadWMSEpsg4326() is defined in wms.js
		loadWMSEpsg4326(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(46, 2)); // France in the center   //*********************
		map.setZoom(6);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg4326(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }


      // this layer uses projection reference EPSG:4326
      // so the loaded layer image cannot match precisely with google maps (EPSG:3857)
 	  if (layerChosen == "BGR1MGU"){    //*********************
		WmsServerURL = 'http://www.bgr.de/Service/OneGeology/BGR_EN_Geological_Units/?'; //*********************
		WmsLayerName = 'DEU_EN_BGR_1M_Geological_Units';  //*********************
		EpsgCode = "SRS=EPSG:4326";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://www.bgr.de/Service/OneGeology/BGR_EN_Geological_Units/?service=WMS&version=1.1.1&request=GetCapabilities
	    // NOTE that the GetFeatureInfo request temporarilly does not work with this layer (2012-11-06)
        var customParams = [
		    "SRS=EPSG:4326", 
            "VERSION=1.1.1",
			"LAYERS=DEU_EN_BGR_1M_Geological_Units"  //*********************
        ];
		
		//loadWMSEpsg4326() is defined in wms.js
		loadWMSEpsg4326(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(51, 10.5)); // Germany in the center   //*********************
		map.setZoom(6);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg4326(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }

 	  
	  
      // this layer uses projection reference EPSG:4326
      // so the loaded layer image cannot match precisely with google maps (EPSG:3857)
 	  if (layerChosen == "ISPRA500kGU"){
		WmsServerURL = 'http://sgi2.isprambiente.it/wmsconnector/com.esri.wms.Esrimap/oneg_eng?';
		WmsLayerName = 'ITA_ISPRASGI_EN_500k_GeologicUnit';
		EpsgCode = "SRS=EPSG:4326";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://sgi2.isprambiente.it/wmsconnector/com.esri.wms.Esrimap/oneg_eng?service=WMS&version=1.1.1&request=GetCapabilities
	
        var customParams = [
		    "SRS=EPSG:4326", 
            "VERSION=1.1.1",
			"LAYERS=ITA_ISPRASGI_EN_500k_GeologicUnit"
        ];
		
		//loadWMSEpsg4326() is defined in wms.js
		loadWMSEpsg4326(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(42, 12)); // Italy in the center
		map.setZoom(6); 
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg4326(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }


      // this layer uses projection reference EPSG:4326
      // so the loaded layer image cannot match precisely with google maps (EPSG:3857)
 	  if (layerChosen == "AUS2d5MGUA"){    //*********************
		WmsServerURL = 'http://www.ga.gov.au/wms/getmap?dataset=geows&'; //*********************
		WmsLayerName = 'AUS_GA_2500k_BA';  //*********************
		EpsgCode = "SRS=EPSG:4326";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://www.ga.gov.au/wms/getmap?dataset=geows&service=WMS&version=1.1.1&request=GetCapabilities
	     
        var customParams = [
		    "SRS=EPSG:4326", 
            "VERSION=1.1.1",
			"LAYERS=AUS_GA_2500k_BA"  //*********************
        ];
		
		//loadWMSEpsg4326() is defined in wms.js
		loadWMSEpsg4326(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(-27, 135)); // Australia in the center   //*********************
		map.setZoom(4);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg4326(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }	


	  
      // this layer uses projection reference EPSG:4326
      // so the loaded layer image cannot match precisely with google maps (EPSG:3857)
 	  if (layerChosen == "SIGA10MBA"){    //*********************
		WmsServerURL = 'http://mapdmzrec.brgm.fr/cgi-bin/mapserv?map=/carto/ogg/mapFiles/SIGAfrique_EN_Bedrock_and_Structural_Geology.map&'; //*********************
		WmsLayerName = 'Africa_SIGAfrique_10M_BedrockAge';  //*********************
		EpsgCode = "SRS=EPSG:4326";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://mapdmzrec.brgm.fr/cgi-bin/mapserv?map=/carto/ogg/mapFiles/SIGAfrique_EN_Bedrock_and_Structural_Geology.map&service=WMS&version=1.1.1&request=GetCapabilities
	    // NOTE that the GetFeatureInfo request temporarilly does not work with this layer (2012-11-06)
        var customParams = [
		    "SRS=EPSG:4326", 
            "VERSION=1.1.1",
			"LAYERS=Africa_SIGAfrique_10M_BedrockAge"  //*********************
        ];
		
		//loadWMSEpsg4326() is defined in wms.js
		loadWMSEpsg4326(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(6, 17)); // Africa in the center   //*********************
		map.setZoom(3);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg4326(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }	  

	  /*
	  //China Geological Survey 1:1M geological map (attributes in Chinese)
      // this layer uses projection reference EPSG:4326
      // so the loaded layer image cannot match precisely with google maps (EPSG:3857)
 	  if (layerChosen == "CGS1MGeoMap"){    //*********************
		WmsServerURL = 'http://219.142.81.86/igserver/ogc/mapdoc/100wan/WMSDocServer?'; //*********************
		WmsLayerName = '0:地质体.WP';  //*********************
		EpsgCode = "SRS=EPSG:4326";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://219.142.81.86/igserver/ogc/mapdoc/100wan/WMSDocServer?service=WMS&version=1.1.1&request=GetCapabilities
        var customParams = [
		    "SRS=EPSG:4326", 
            "VERSION=1.1.1",
			"LAYERS=0:地质体.WP",
			"QUERY_LAYERS=0:地质体.WP",
			"STYLES="	//this parameter is needed in order to import the image of this layer
        ];
		
		//loadWMSEpsg4326() is defined in wms.js
		loadWMSEpsg4326(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(34, 107)); // China in the center   //*********************
		map.setZoom(4);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg4326(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  } */	  
  
	  //China Geological Survey 1:5M geological map (attributes in Chinese)
      // this layer uses projection reference EPSG:4326
      // so the loaded layer image cannot match precisely with google maps (EPSG:3857)
 	  if (layerChosen == "CGS5MGeoMap"){    //*********************
		WmsServerURL = 'http://219.142.81.85/arcgis/services/MAS12P51000011/MapServer/WMSServer?'; //*********************
		WmsLayerName = '0';  //*********************
		EpsgCode = "SRS=EPSG:4326";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://219.142.81.85/arcgis/services/GeomapM5/MapServer/WMSServer?service=WMS&version=1.1.1&request=GetCapabilities
        var customParams = [
		    "SRS=EPSG:4326", 
            "VERSION=1.1.1",
			"LAYERS=0",
			"QUERY_LAYERS=0",
			"STYLES="	//this parameter is needed in order to import the image of this layer
        ];
		
		//loadWMSEpsg4326() is defined in wms.js
		loadWMSEpsg4326(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(34, 107)); // China in the center   //*********************
		map.setZoom(4);   //*********************
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg4326(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }	  

	  
	  // the BRGM 50M (world geology) Onshore WMS layer only supports projection reference EPSG:4326
      // so the loaded layer image cannot match precisely with google maps (EPSG:3857)
      // We  left this here (on 2012-11-06)to show the problem and as a candidate for further works	  
	  if (layerChosen == "BRGM50MOnshore"){
		WmsServerURL = 'http://mapdmzrec.brgm.fr/cgi-bin/mapserv54?map=/carto/ogg/mapFiles/CGMW_Bedrock_and_Structural_Geology.map&';
		WmsLayerName = 'World_CGMW_50M_GeologicalUnitsOnshore';
		EpsgCode = "SRS=EPSG:4326";
		VersionCode = "VERSION=1.1.1";
		// through getCapabilities we can see which EPSG the WMS server supports
		// http://mapdmzrec.brgm.fr/cgi-bin/mapserv54?map=/carto/ogg/mapFiles/CGMW_Bedrock_and_Structural_Geology.map&service=WMS&version=1.1.1&request=GetCapabilities
	
        var customParams = [
		    "SRS=EPSG:4326", 
            "VERSION=1.1.1",
			"LAYERS=World_CGMW_50M_GeologicalUnitsOnshore"
        ];
		
		//loadWMSEpsg4326() is defined in wms.js
		loadWMSEpsg4326(map, WmsServerURL, customParams);
		
		map.panTo(new google.maps.LatLng(0, 0)); // World in the center
		map.setZoom(2); 
		
		listenerHandleWmsInfoClose = google.maps.event.addListener(map, 'click', function() {
			infoPopupWMS.close(); //click the map area to close the popup WMS feature info window
		});
		listenerHandleWmsInfoOpen = google.maps.event.addListener(map, 'click', function(event) {
			ClickForWmsInfoEpsg4326(event.latLng);
		});	
		
		map.setOptions({draggableCursor: 'help'});	
		map.setOptions({draggingCursor: 'help'});		
	  }
	}
  </script> 
</body>
